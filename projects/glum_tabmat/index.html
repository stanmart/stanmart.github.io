<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>User-friendly GLMs with glum 3 | Martin Stancsics</title> <meta name="author" content="Martin Stancsics"/> <meta name="description" content="High-performance and user-friendly GLM estimation in Python"/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¾</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://stanmart.github.io/projects/glum_tabmat/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">MartinÂ </span>Stancsics</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item "> <a class="nav-link" href="/blog/">blog</a> </li> <li class="nav-item "> <a class="nav-link" href="/papers/">papers</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">User-friendly GLMs with glum 3</h1> <p class="post-description">High-performance and user-friendly GLM estimation in Python</p> </header> <article> <p><em><a href="https://github.com/Quantco/glum" target="_blank" rel="noopener noreferrer">glum</a></em> is a lightning fast Python package for estimating Generalized Linear Models (GLMs). It can handle mixed sparsity (dense, sparse and categorical) data in a memory and computationally efficient way. My main task during my 2023 internship at <a href="https://quantco.com/" target="_blank" rel="noopener noreferrer">QuantCo</a> was to improve glum, and its backend library, <em><a href="https://github.com/Quantco/tabmat" target="_blank" rel="noopener noreferrer">tabmat</a></em> even further.</p> <p>glum follows scikit-learnâ€™s API conventions, so it is easily composable with other tools. However, many people with a statistics or econometrics background are rather used to formula interfaces, such as the ones provided by Râ€™s glm or Pythonâ€™s statsmodels packages. To make glum more user-friendly for these users, and more suitable for exploratory analysis, I developed a formula interface for glum, based on the fantastic <a href="https://matthewwardrop.github.io/formulaic/" target="_blank" rel="noopener noreferrer">formulaic</a> library. Since th v3 release, glum can now do the following:</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span> <span class="o">=</span> <span class="n">glum</span><span class="p">.</span><span class="nc">GeneralizedLinearRegressor</span><span class="p">(</span>
    <span class="n">formula</span><span class="o">=</span><span class="p">(</span>
        <span class="sh">"</span><span class="s">Miles_per_Gallon ~ Weight_in_lbs + {Weight_in_lbs**2} </span><span class="sh">"</span>
        <span class="sh">"</span><span class="s">+ bs(Horsepower, 3) + C(Cylinders) * Origin</span><span class="sh">"</span>
    <span class="p">),</span>
    <span class="n">store</span>
    <span class="n">alpha</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span>
<span class="n">model</span><span class="p">.</span><span class="nf">fit</span><span class="p">(</span><span class="n">cars</span><span class="p">[:</span><span class="mi">380</span><span class="p">],</span> <span class="n">store_covariance_matrix</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">pred</span> <span class="o">=</span> <span class="n">model</span><span class="p">.</span><span class="nf">predict</span><span class="p">(</span><span class="n">cars</span><span class="p">[</span><span class="mi">380</span><span class="p">:])</span>

</code></pre></div></div> <p>True to glumâ€™s spirit, the formula interface was also designed with performance in mind. In particular, variable interactions preserve sparsity (the interaction of a dense and a sparse column will always be sparse), and glum uses this fact to save memory. Furthermore, glum exploits the observation that the interaction of any two categoricals can be represented as one new categorical. This makes it possible to include interactions with high-cardinality categoricals in models without worrying about memory implications. For example, the following code snippet should run without problems on an average computer.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span>
    <span class="p">{</span>
        <span class="sh">"</span><span class="s">c1</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Categorical</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1_000_000</span><span class="p">)),</span>
        <span class="sh">"</span><span class="s">c2</span><span class="sh">"</span><span class="p">:</span> <span class="n">pd</span><span class="p">.</span><span class="nc">Categorical</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">randint</span><span class="p">(</span><span class="n">low</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mi">200</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">1_000_000</span><span class="p">)),</span>
        <span class="sh">"</span><span class="s">y</span><span class="sh">"</span><span class="p">:</span> <span class="n">np</span><span class="p">.</span><span class="n">random</span><span class="p">.</span><span class="nf">rand</span><span class="p">(</span><span class="mi">1_000_000</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">)</span>
<span class="n">big_model</span> <span class="o">=</span> <span class="n">glum</span><span class="p">.</span><span class="nc">GeneralizedLinearRegressor</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="sh">"</span><span class="s">y ~ c1 : c2</span><span class="sh">"</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mi">1</span><span class="p">).</span><span class="nf">fit</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</code></pre></div></div> <p>While the formula interface is the highlight of glumâ€™s v3 release (and tabmatâ€™s v4 release), there are a number of other improvements as well. These include more flexible variable (and term) names, easy-to-use Wald tests, and a more flexible handing of missing values in categorical columns. The following snippet shows the different ways to perform a Wald test in glum.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">model</span><span class="p">.</span><span class="nf">wald_test</span><span class="p">(</span><span class="n">features</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">Weight_in_lbs</span><span class="sh">"</span><span class="p">,</span> <span class="sh">"</span><span class="s">Weight_in_lbs ** 2</span><span class="sh">"</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="nf">wald_test</span><span class="p">(</span><span class="n">terms</span><span class="o">=</span><span class="p">[</span><span class="sh">"</span><span class="s">bs(Horsepower, 3)</span><span class="sh">"</span><span class="p">],</span> <span class="n">r</span><span class="o">=</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">model</span><span class="p">.</span><span class="nf">wald_test</span><span class="p">(</span><span class="n">formula</span><span class="o">=</span><span class="sh">"</span><span class="s">-2 * Weight_in_lbs = `Weight_in_lbs ** 2`</span><span class="sh">"</span><span class="p">)</span>
</code></pre></div></div> <p>tabmat also went through a refactoring to unify its API, and make it easier to improve and maintain in the future without breaking changes. It can now also store column and term names for the various matrix types it supports, bringing it closer to the vision of being in-between matrix libraries like numpy and full-fledged dataframes like pandas or polars.</p> <p>For more details, check out the following links:</p> <ul> <li><a href="https://tech.quantco.com/blog/glum-v3" target="_blank" rel="noopener noreferrer">Quantco tech blog post about the release</a></li> <li><a href="https://glum.readthedocs.io/en/latest/tutorials/formula_interface/formula_interface.html#" target="_blank" rel="noopener noreferrer">Example notebook showcasing the formula interface</a></li> <li><a href="https://github.com/Quantco/glum/releases/tag/v3.0.0" target="_blank" rel="noopener noreferrer">glum v3 release notes</a></li> <li><a href="https://github.com/Quantco/tabmat/releases/tag/4.0.0" target="_blank" rel="noopener noreferrer">tabmat v4 release notes</a></li> </ul> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> Â© Copyright 2025 Martin Stancsics. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>