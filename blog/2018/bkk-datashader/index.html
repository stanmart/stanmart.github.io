<!DOCTYPE html> <html lang="en"> <head> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title>Visualizing public transport | Martin Stancsics</title> <meta name="author" content="Martin Stancsics"/> <meta name="description" content="A simple, whitespace theme for academics. Based on [*folio](https://github.com/bogoli/-folio) design. "/> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"/> <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha256-DF7Zhf293AJxJNTmh5zhoYYIMs2oXitRfBjY+9L//AY=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"/> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/academicons@1.9.1/css/academicons.min.css" integrity="sha256-i1+4qU2G2860dGGIOJscdC30s9beBXjFfzjWLjBRsBg=" crossorigin="anonymous"> <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/github.css" media="none" id="highlight_theme_light"/> <link rel="shortcut icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>ðŸ’¾</text></svg>"> <link rel="stylesheet" href="/assets/css/main.css"> <link rel="canonical" href="https://stanmart.github.io/blog/2018/bkk-datashader/"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/jwarby/jekyll-pygments-themes@master/native.css" media="none" id="highlight_theme_dark"/> <script src="/assets/js/theme.js"></script> <script src="/assets/js/dark_mode.js"></script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"><span class="font-weight-bold">MartinÂ </span>Stancsics</a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about</a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog<span class="sr-only">(current)</span></a> </li> <li class="nav-item "> <a class="nav-link" href="/papers/">papers</a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">projects</a> </li> <li class="nav-item "> <a class="nav-link" href="/repositories/">repositories</a> </li> <li class="nav-item "> <a class="nav-link" href="/cv/">cv</a> </li> <li class="nav-item "> <a class="nav-link" href="/teaching/">teaching</a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="fas fa-moon"></i> <i class="fas fa-sun"></i> </button> </li> </ul> </div> </div> </nav> </header> <div class="container mt-5"> <div class="post"> <header class="post-header"> <h1 class="post-title">Visualizing public transport</h1> <p class="post-meta">October 17, 2018</p> <p class="post-tags"> <a href="/blog/2018"> <i class="fas fa-calendar fa-sm"></i> 2018 </a> Â  Â· Â  <a href="/blog/tag/geodata"> <i class="fas fa-hashtag fa-sm"></i> geodata</a> Â  <a href="/blog/tag/datashader"> <i class="fas fa-hashtag fa-sm"></i> datashader</a> Â  <a href="/blog/tag/python"> <i class="fas fa-hashtag fa-sm"></i> python</a> Â  <a href="/blog/tag/plotting"> <i class="fas fa-hashtag fa-sm"></i> plotting</a> Â  <a href="/blog/tag/budapest"> <i class="fas fa-hashtag fa-sm"></i> budapest</a> Â  </p> </header> <article class="post-content"> <p>Plotting stuff is fun. Plotting stuff on top of maps is even more fun. Even better, using modern Python visualizaton libraries, plotting on top of maps is simple, too.</p> <p>Plotting large datasets is also a lot of fun, but sadly, it is difficult. One has to fiddle with sampling, opacity, and various parameters to visualize datasets over a million points. Isnâ€™t there a better way?</p> <p>As it turns out, there is. The extraordinary <code class="language-plaintext highlighter-rouge">datashader</code> library made by the people at Anaconda Inc might be a game changer for meaningfully visualizing large datasets. This write up is inspired by the <a href="http://datashader.org/topics/nyc_taxi.html" target="_blank" rel="noopener noreferrer">NYC taxi example</a> at the wonderful <a href="http://pyviz.org/" target="_blank" rel="noopener noreferrer">PyViz</a> website.</p> <p>On one hand, I did this project to familiarize myself with the <code class="language-plaintext highlighter-rouge">datashader</code> library, and on the other hand, I wanted to make use of the plenty of data published by the Centre for Budapest Transport (BKK). The next few paragraphs can be viewed as a tutorial on making spatial plots with <code class="language-plaintext highlighter-rouge">datashader</code>, or as an (admittedly superficial) description of Budapestâ€™s public transport system.</p> <h2 id="first-approach-using-gtfs-data">First approach: using GTFS data</h2> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/bkk-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/bkk-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/bkk-1400.webp"></source> <img src="/assets/img/bkk/bkk.png" width="300" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The Centre for Budapest Transport (BKK) makes its timetables available in the widely used and public GTFS format (General Transit Feed Specification) to make creating public transport related applications easy for developers. However, this very same data can also be used to analyze and visualize the public transport system of Budapest.</p> <p>The GTFS format is a simple database: a zip files containing a set of comma-separated csv files which can be joined to each other based on some key columns. Let us start by downloading the most current timetable and looking at its contents.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">shutil</span>
<span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">zipfile</span>

<span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="sh">'</span><span class="s">http://www.bkk.hu/gtfs/budapest_gtfs.zip</span><span class="sh">'</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="sh">'</span><span class="s">budapest_gtfs.zip</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">wb</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="n">shutil</span><span class="p">.</span><span class="nf">copyfileobj</span><span class="p">(</span><span class="n">req</span><span class="p">.</span><span class="n">raw</span><span class="p">,</span> <span class="nb">file</span><span class="p">)</span>
    
<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="sh">'</span><span class="s">./data</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="sh">'</span><span class="s">./data</span><span class="sh">'</span><span class="p">)</span>
    
<span class="k">with</span> <span class="n">zipfile</span><span class="p">.</span><span class="nc">ZipFile</span><span class="p">(</span><span class="sh">'</span><span class="s">budapest_gtfs.zip</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">r</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
    <span class="nb">file</span><span class="p">.</span><span class="nf">extractall</span><span class="p">(</span><span class="sh">'</span><span class="s">./data</span><span class="sh">'</span><span class="p">)</span>

<span class="n">os</span><span class="p">.</span><span class="nf">listdir</span><span class="p">(</span><span class="sh">'</span><span class="s">./data</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>['agency.txt',
 'calendar_dates.txt',
 'feed_info.txt',
 'pathways.txt',
 'routes.txt',
 'shapes.txt',
 'stops.txt',
 'stop_times.txt',
 'trips.txt']
</code></pre></div></div> <p>It is possible that you will not be able to download the above file if you are outside of Hungary. You can then either try a VPN, or get the version that I downloaded on 14th October 2018 from <a href="https://drive.google.com/open?id=1WZ3um5GOfhCq6l_aXWxiCrh_BX2qiufO" target="_blank" rel="noopener noreferrer">here</a> (Google Drive link, might not be up indefinitely).</p> <p>The files that are going to be relevant for us in order to create a map are:</p> <ul> <li> <code class="language-plaintext highlighter-rouge">trips.txt</code> which contained every scheduled trip line-by-line and</li> <li> <code class="language-plaintext highlighter-rouge">shapes.txt</code> which is a spatial description of each route (longitude and latitude information).</li> </ul> <p>The two tables are linked by <code class="language-plaintext highlighter-rouge">shape_id</code>, which is the primary key of the shapes table. Letâ€™s load the files and look at the data!</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="n">trips</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/trips.txt</span><span class="sh">'</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">shapes</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">data/shapes.txt</span><span class="sh">'</span><span class="p">,</span> <span class="n">low_memory</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">trips</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <table> <thead> <tr> <th>route_id</th> <th>trip_id</th> <th>service_id</th> <th>â€¦</th> <th>shape_id</th> <th>â€¦</th> <th>boarding_door</th> </tr> </thead> <tbody> <tr> <td>8140</td> <td>B0571610</td> <td>B05716AHPKP-0011</td> <td>â€¦</td> <td>Y701</td> <td>â€¦</td> <td>2.0</td> </tr> <tr> <td>8140</td> <td>B0571611</td> <td>B05716AHPKP-0011</td> <td>â€¦</td> <td>Y702</td> <td>â€¦</td> <td>2.0</td> </tr> <tr> <td>8140</td> <td>B0571612</td> <td>B05716AHPKP-0011</td> <td>â€¦</td> <td>Y701</td> <td>â€¦</td> <td>2.0</td> </tr> <tr> <td>8140</td> <td>B0571613</td> <td>B05716AHPKP-0011</td> <td>â€¦</td> <td>Y702</td> <td>â€¦</td> <td>2.0</td> </tr> <tr> <td>8140</td> <td>B0571614</td> <td>B05716AHPKP-0011</td> <td>â€¦</td> <td>Y701</td> <td>â€¦</td> <td>2.0</td> </tr> </tbody> </table> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">shapes</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <table> <thead> <tr> <th>shape_id</th> <th>shape_pt_sequence</th> <th>shape_pt_lat</th> <th>shape_pt_lon</th> <th>shape_dist_traveled</th> </tr> </thead> <tbody> <tr> <td>0285</td> <td>100001</td> <td>47.519630</td> <td>19.148313</td> <td>0.0</td> </tr> <tr> <td>0285</td> <td>100002</td> <td>47.519657</td> <td>19.148286</td> <td>4.0</td> </tr> <tr> <td>0285</td> <td>100003</td> <td>47.519839</td> <td>19.148638</td> <td>35.0</td> </tr> <tr> <td>0285</td> <td>100004</td> <td>47.520584</td> <td>19.150246</td> <td>182.0</td> </tr> <tr> <td>0285</td> <td>100005</td> <td>47.520674</td> <td>19.150432</td> <td>199.0</td> </tr> </tbody> </table> <p>Looks simple enough. If we would like to plot the trafic of the transit network, we just have to aggregate the <code class="language-plaintext highlighter-rouge">trips</code> table by counting the number of lines by <code class="language-plaintext highlighter-rouge">shape_id</code>, join the two tables by <code class="language-plaintext highlighter-rouge">shape_id</code>, and make a line plot.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">num_trips_by_shape</span> <span class="o">=</span> <span class="n">trips</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="sh">'</span><span class="s">shape_id</span><span class="sh">'</span><span class="p">).</span><span class="nf">aggregate</span><span class="p">({</span><span class="sh">'</span><span class="s">route_id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">count</span><span class="sh">'</span><span class="p">}).</span><span class="nf">reset_index</span><span class="p">()</span>
<span class="n">num_trips_by_shape</span><span class="p">.</span><span class="nf">rename</span><span class="p">({</span><span class="sh">'</span><span class="s">route_id</span><span class="sh">'</span><span class="p">:</span> <span class="sh">'</span><span class="s">trip_count</span><span class="sh">'</span><span class="p">},</span> <span class="n">axis</span><span class="o">=</span><span class="sh">'</span><span class="s">columns</span><span class="sh">'</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

<span class="n">shapes_with_nums</span> <span class="o">=</span> <span class="n">shapes</span><span class="p">.</span><span class="nf">merge</span><span class="p">(</span><span class="n">num_trips_by_shape</span><span class="p">,</span> <span class="n">on</span><span class="o">=</span><span class="sh">'</span><span class="s">shape_id</span><span class="sh">'</span><span class="p">)</span>
<span class="n">shapes_with_nums</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <table> <thead> <tr> <th>shape_id</th> <th>shape_pt_sequence</th> <th>shape_pt_lat</th> <th>shape_pt_lon</th> <th>shape_dist_traveled</th> <th>trip_count</th> </tr> </thead> <tbody> <tr> <td>0285</td> <td>100001</td> <td>47.519630</td> <td>19.148313</td> <td>0.0</td> <td>6</td> </tr> <tr> <td>0285</td> <td>100002</td> <td>47.519657</td> <td>19.148286</td> <td>4.0</td> <td>6</td> </tr> <tr> <td>0285</td> <td>100003</td> <td>47.519839</td> <td>19.148638</td> <td>35.0</td> <td>6</td> </tr> <tr> <td>0285</td> <td>100004</td> <td>47.520584</td> <td>19.150246</td> <td>182.0</td> <td>6</td> </tr> <tr> <td>0285</td> <td>100005</td> <td>47.520674</td> <td>19.150432</td> <td>199.0</td> <td>6</td> </tr> </tbody> </table> <p>We are almost there, only two minor details are missing.</p> <p>First, if we would like to use map tiles as a background for our plots, we will have to convert the latitute-longitude data to Web-Mercator coordinates, as Bokeh can only handle the latter. Fortunately, there is a handy function in the <code class="language-plaintext highlighter-rouge">datashader</code> package to do just this.</p> <p>The second issue is that if we were to make a line plot of the above database as it is, the last point of each shape would be connected to the first point of the next shape. We can avoid this by inserting a row of <code class="language-plaintext highlighter-rouge">NaN</code>s between each shape.</p> <p>The next block deals with these problems.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">from</span> <span class="n">datashader.utils</span> <span class="kn">import</span> <span class="n">lnglat_to_meters</span>
<span class="kn">import</span> <span class="n">numpy</span> <span class="k">as</span> <span class="n">np</span>

<span class="n">shapes_with_nums</span><span class="p">[</span><span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">],</span> <span class="n">shapes_with_nums</span><span class="p">[</span><span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> \
    <span class="nf">lnglat_to_meters</span><span class="p">(</span><span class="n">shapes_with_nums</span><span class="p">[</span><span class="sh">'</span><span class="s">shape_pt_lon</span><span class="sh">'</span><span class="p">],</span> <span class="n">shapes_with_nums</span><span class="p">[</span><span class="sh">'</span><span class="s">shape_pt_lat</span><span class="sh">'</span><span class="p">])</span>

<span class="k">def</span> <span class="nf">split_df_by</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">byvar</span><span class="p">):</span>
    <span class="n">df_parts</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">level</span><span class="p">,</span> <span class="n">df_part</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="nf">groupby</span><span class="p">(</span><span class="n">byvar</span><span class="p">):</span>
        <span class="n">empty</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">([[</span><span class="n">level</span> <span class="k">if</span> <span class="n">colname</span> <span class="o">==</span> <span class="n">byvar</span> <span class="k">else</span> <span class="n">np</span><span class="p">.</span><span class="n">NaN</span> <span class="k">for</span> <span class="n">colname</span> <span class="ow">in</span> <span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">]],</span>
                             <span class="n">columns</span><span class="o">=</span><span class="n">df</span><span class="p">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="n">df_parts</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">df_part</span><span class="p">.</span><span class="nf">append</span><span class="p">(</span><span class="n">empty</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">pd</span><span class="p">.</span><span class="nf">concat</span><span class="p">(</span><span class="n">df_parts</span><span class="p">)</span> 

<span class="n">sep_shapes</span> <span class="o">=</span> <span class="nf">split_df_by</span><span class="p">(</span><span class="n">shapes_with_nums</span><span class="p">,</span> <span class="sh">'</span><span class="s">shape_id</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <p>Everything is set, now on to the plot!</p> <p>We will do it in four steps:</p> <ol> <li>We create a bokeh figure, and hide grids and axes for aesthetic reasons.</li> <li>Next, we add map tiles to this figure using <code class="language-plaintext highlighter-rouge">bokeh</code>â€™s <code class="language-plaintext highlighter-rouge">WMTSTileSource</code> function and an XYZ map source.</li> <li>Then we define a callback function that wraps up <code class="language-plaintext highlighter-rouge">datashader</code> plotting steps, and returns a datashaded image given plot ranges and figure size. These steps are the following: <ol> <li>Create a canvas with the given ranges (in coordinates) and size (in pixels)</li> <li>Plot the lines and aggregate to the pixel level. Here we use the sum of trip counts, as we are interested in the number of vehicles per day at a given location.</li> <li>Then we transform the aggregates into an image by shading according to a colormap and a link function (in this case, colors will mean percentiles as a result of using <code class="language-plaintext highlighter-rouge">'eq_hist'</code>).</li> </ol> </li> <li>Finally, we use the <code class="language-plaintext highlighter-rouge">InteractiveImage</code> function from <code class="language-plaintext highlighter-rouge">datashader</code> to link the plot and the data shading steps, and display the figure.</li> </ol> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">bokeh.plotting</span> <span class="k">as</span> <span class="n">bp</span>
<span class="kn">from</span> <span class="n">bokeh.models.tiles</span> <span class="kn">import</span> <span class="n">WMTSTileSource</span>
<span class="kn">import</span> <span class="n">datashader</span> <span class="k">as</span> <span class="n">ds</span>
<span class="kn">import</span> <span class="n">datashader.transfer_functions</span> <span class="k">as</span> <span class="n">tf</span>
<span class="kn">from</span> <span class="n">datashader.bokeh_ext</span> <span class="kn">import</span> <span class="n">InteractiveImage</span>
<span class="kn">from</span> <span class="n">datashader.utils</span> <span class="kn">import</span> <span class="n">export_image</span>
<span class="kn">import</span> <span class="n">colorcet</span> <span class="k">as</span> <span class="n">cc</span>

<span class="n">bp</span><span class="p">.</span><span class="nf">output_notebook</span><span class="p">()</span>

<span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mf">2.101e6</span><span class="p">,</span> <span class="mf">2.155e6</span><span class="p">)</span>
<span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mf">5.994e6</span><span class="p">,</span> <span class="mf">6.052e6</span><span class="p">)</span>

<span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">exists</span><span class="p">(</span><span class="sh">'</span><span class="s">./img</span><span class="sh">'</span><span class="p">):</span>
    <span class="n">os</span><span class="p">.</span><span class="nf">mkdir</span><span class="p">(</span><span class="sh">'</span><span class="s">./img</span><span class="sh">'</span><span class="p">)</span>
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="sh">'</span><span class="s">pan,wheel_zoom,reset</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">plot_width</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">plot_height</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span>
              <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>

<span class="n">p</span><span class="p">.</span><span class="n">axis</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p</span><span class="p">.</span><span class="n">xgrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">p</span><span class="p">.</span><span class="n">ygrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://cartodb-basemaps-b.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png</span><span class="sh">"</span>
<span class="n">tile_renderer</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">add_tile</span><span class="p">(</span><span class="nc">WMTSTileSource</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
<span class="n">tile_renderer</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">color_fn</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">shade</span><span class="p">):</span>
    <span class="n">cvs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="nc">Canvas</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">line</span><span class="p">(</span><span class="n">sep_shapes</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">sum</span><span class="p">(</span><span class="sh">'</span><span class="s">trip_count</span><span class="sh">'</span><span class="p">))</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cc</span><span class="p">.</span><span class="n">fire</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">image</span>

<span class="nf">export_image</span><span class="p">(</span><span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
             <span class="n">filename</span><span class="o">=</span><span class="sh">"</span><span class="s">BUD_schedule_fire</span><span class="sh">"</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
<span class="nc">InteractiveImage</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">image_callback</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/plot1_snip-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/plot1_snip-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/plot1_snip-1400.webp"></source> <img src="/assets/img/bkk/plot1_snip.png" width="600" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The image you see on this webpage is just a static image due to the limitations of the site engine (or more accurately, my inability to make it work with Bokeh plots), but if you run this example in a notebook, you can pan and zoom interactively. Furthermore, the datashading callback function is run each time, so you get a nicely shaded picture with meaningful colors every time.</p> <h2 id="second-approach-using-gps-data">Second approach: using GPS data</h2> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/futar_logo-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/futar_logo-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/futar_logo-1400.webp"></source> <img src="/assets/img/bkk/futar_logo.jpg" width="300" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>In the first part we managed to plot the number of vehicles scheduled to pass through each location on a given day. It is informative as it is, but it does not really represent the average number of vehicles at a given location and at a given time. There are multiple reasons for this. Clearly, the schedule is just a plan, and the actual routes and stop times might vary due to delays an unforeseen events. A more subtle reason is that vehicles do not spend the time on a given route evenly. They spend more time where they must go slower, spend time in stops and spend even more time in terminals.</p> <p>Whether we are interested in the number of vehicles passing or the average number of vehicles at a given location (or alternatively, the probability density of vehicle locations) depends on the question we are trying to answer. For example, if we are analysing the amortization of the road surface, the former metric seems quite useful. On the other hand, if we would like to say something about air pollution, the latter one is the way to go.</p> <p>To plot the density of vehicle loccations, we need different data: the locations of vehicles during a given day. Furtunately, in addition to publishing the timetables in GTFS format, BKK also track the location of its buses, trolleybuses trams and ferries in real time (sadly, no data on the metro), so that websites and applications <a href="http://futar.bkk.hu/?map=16/47.50955/19.03137&amp;layers=GSVB" target="_blank" rel="noopener noreferrer">like this</a> are possible. We can use it to query tthe location of each active vehicle at a regular interval, and then we can simply make a scatterplot of the resulting (quite sizeable) database. It is exactly what I have done (apart from a five-minute-long internet hiatus), and you can download the data in a zipped csv <a href="https://drive.google.com/file/d/1lx9pN1TURCczB2rbcJaFU1Eg42gonmZu/view?usp=sharing" target="_blank" rel="noopener noreferrer">from here</a> (Google Drive link, might not be up indefinitely).</p> <p>If you are feeling adventurous, you can also try getting the data for yourself. You can find some details on how to do this at the end of this post.</p> <p>Let us start by looking at our data!</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">futar</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nf">read_csv</span><span class="p">(</span><span class="sh">'</span><span class="s">C:/bkkdata/vfl_data.csv</span><span class="sh">'</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="sh">'</span><span class="s">cp1250</span><span class="sh">'</span><span class="p">)</span>
<span class="nf">print</span><span class="p">(</span><span class="nf">len</span><span class="p">(</span><span class="n">futar</span><span class="p">))</span>
<span class="n">futar</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>11054989
</code></pre></div></div> <table> <thead> <tr> <th>Unnamed: 0</th> <th>â€¦</th> <th>lastUpdateTime</th> <th>licensePlate</th> <th>location</th> <th>model</th> <th>â€¦</th> <th>vehicleRouteType</th> </tr> </thead> <tbody> <tr> <td>0</td> <td>â€¦</td> <td>1539671351</td> <td>LOV870</td> <td>{â€˜latâ€™: 47.44018, â€˜lonâ€™: 19.09628}</td> <td>VanHool AG318 csuklÃ³s autÃ³busz</td> <td>â€¦</td> <td>BUS</td> </tr> <tr> <td>1</td> <td>â€¦</td> <td>1539671354</td> <td>V1440</td> <td>{â€˜latâ€™: 47.483326, â€˜lonâ€™: 19.053127}</td> <td>Ganz csuklÃ³s</td> <td>â€¦</td> <td>TRAM</td> </tr> <tr> <td>2</td> <td>â€¦</td> <td>1539671350</td> <td>V2112</td> <td>{â€˜latâ€™: 47.469288, â€˜lonâ€™: 19.082859}</td> <td>CAF 9 modulos szerelvÃ©ny</td> <td>â€¦</td> <td>TRAM</td> </tr> <tr> <td>3</td> <td>â€¦</td> <td>1539671351</td> <td>V4334</td> <td>{â€˜latâ€™: 47.443512, â€˜lonâ€™: 19.036741}</td> <td>TÃ¡tra T5C5K</td> <td>â€¦</td> <td>TRAM</td> </tr> <tr> <td>4</td> <td>â€¦</td> <td>1539671367</td> <td>V1442</td> <td>{â€˜latâ€™: 47.520626, â€˜lonâ€™: 19.036764}</td> <td>Ganz csuklÃ³s</td> <td>â€¦</td> <td>TRAM</td> </tr> </tbody> </table> <p>The only thing we need from here are the coordinates (<code class="language-plaintext highlighter-rouge">location</code>), but unfortunately they are in a rather peculiar format: a string that looks like a dictionary. Also, we will need to convert the latitudes and longitudes into Web-Mercator coordinates again. Let us sort these out and make it into a proper dataframe!</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">lat_lon_df</span> <span class="o">=</span> <span class="n">futar</span><span class="p">.</span><span class="n">location</span><span class="p">.</span><span class="nb">str</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="sh">"</span><span class="s">,</span><span class="sh">"</span><span class="p">,</span> <span class="n">expand</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="n">lats</span> <span class="o">=</span> <span class="n">lat_lon_df</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s">{</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>
<span class="n">lons</span> <span class="o">=</span> <span class="n">lat_lon_df</span><span class="p">[</span><span class="mi">1</span><span class="p">].</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">"</span><span class="s"> </span><span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="s">: </span><span class="sh">"</span><span class="p">,</span> <span class="sh">""</span><span class="p">).</span><span class="nb">str</span><span class="p">.</span><span class="nf">replace</span><span class="p">(</span><span class="sh">'</span><span class="s">}</span><span class="sh">'</span><span class="p">,</span> <span class="sh">''</span><span class="p">).</span><span class="nf">astype</span><span class="p">(</span><span class="n">np</span><span class="p">.</span><span class="n">float64</span><span class="p">)</span>

<span class="n">x_coords</span><span class="p">,</span> <span class="n">y_coords</span> <span class="o">=</span> <span class="nf">lnglat_to_meters</span><span class="p">(</span><span class="n">lons</span><span class="p">,</span> <span class="n">lats</span><span class="p">)</span>
<span class="n">gps_data</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">({</span><span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">:</span> <span class="n">x_coords</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">:</span> <span class="n">y_coords</span><span class="p">})</span>
<span class="n">gps_data</span><span class="p">.</span><span class="nf">head</span><span class="p">()</span>
</code></pre></div></div> <table> <thead> <tr> <th>coord_x</th> <th>coord_y</th> </tr> </thead> <tbody> <tr> <td>2.125788e+06</td> <td>6.014221e+06</td> </tr> <tr> <td>2.120984e+06</td> <td>6.021325e+06</td> </tr> <tr> <td>2.124294e+06</td> <td>6.019013e+06</td> </tr> <tr> <td>2.119160e+06</td> <td>6.014769e+06</td> </tr> <tr> <td>2.119163e+06</td> <td>6.027471e+06</td> </tr> </tbody> </table> <p>We are set now, on to the plot! The drill is the same as before, we just replace <code class="language-plaintext highlighter-rouge">cvs.line</code> with <code class="language-plaintext highlighter-rouge">cvs.points</code>.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="sh">'</span><span class="s">pan,wheel_zoom,reset</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">plot_width</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">plot_height</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span>
              <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>
              
<span class="n">p</span><span class="p">.</span><span class="n">axis</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p</span><span class="p">.</span><span class="n">xgrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">p</span><span class="p">.</span><span class="n">ygrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://cartodb-basemaps-b.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png</span><span class="sh">"</span>
<span class="n">tile_renderer</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">add_tile</span><span class="p">(</span><span class="nc">WMTSTileSource</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
<span class="n">tile_renderer</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">color_fn</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">shade</span><span class="p">):</span>
    <span class="n">cvs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="nc">Canvas</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>
    <span class="n">agg</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">points</span><span class="p">(</span><span class="n">gps_data</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="n">cc</span><span class="p">.</span><span class="n">fire</span><span class="p">,</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="nf">dynspread</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_px</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="nf">export_image</span><span class="p">(</span><span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
             <span class="n">filename</span><span class="o">=</span><span class="sh">"</span><span class="s">BUD_gps_fire</span><span class="sh">"</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
<span class="nc">InteractiveImage</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">image_callback</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/plot2_snip-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/plot2_snip-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/plot2_snip-1400.webp"></source> <img src="/assets/img/bkk/plot2_snip.png" width="600" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>The new image is remarkably similar, but there are a few notable differences. Most notably, there are a number of white hotspots where vehicles seem to spend a lot of time. These are usually terminal stations and large traffic junctions, that did not show up this predominantly on our first picture, but must certainly have a large effect on air quality.</p> <p>Or do they? Well, that also depends on the vehicle type. Trams and trolleybuses do not really matter in this regard, while regular buses and ferries certainly do. Letâ€™s see how the above picture looks by vehicle type: <span style="color:#0877bc"><strong>bus</strong></span>, <span style="color:#f89b00"><strong>tram</strong></span>, <span style="color:#ff212a"><strong>trolleybus</strong></span> and <span style="color:#d60080"><strong>ferry</strong></span>.</p> <p>There is not much new stuff going on here: we simply aggregate and shade a dataframe for each type of vehicle, and then merge them using <code class="language-plaintext highlighter-rouge">tf.stack</code>. Note, that unfortunately, the stacking order matters for the final picture. Also, as each part is shaded separately, the densities are going to be displayed according to their relative (conditional) densities.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">data_bus</span> <span class="o">=</span> <span class="n">gps_data</span><span class="p">[</span><span class="n">futar</span><span class="p">.</span><span class="n">vehicleRouteType</span> <span class="o">==</span> <span class="sh">'</span><span class="s">BUS</span><span class="sh">'</span><span class="p">]</span>
<span class="n">data_tram</span> <span class="o">=</span> <span class="n">gps_data</span><span class="p">[</span><span class="n">futar</span><span class="p">.</span><span class="n">vehicleRouteType</span> <span class="o">==</span> <span class="sh">'</span><span class="s">TRAM</span><span class="sh">'</span><span class="p">]</span>
<span class="n">data_trolleybus</span> <span class="o">=</span> <span class="n">gps_data</span><span class="p">[</span><span class="n">futar</span><span class="p">.</span><span class="n">vehicleRouteType</span> <span class="o">==</span> <span class="sh">'</span><span class="s">TROLLEYBUS</span><span class="sh">'</span><span class="p">]</span>
<span class="n">data_ferry</span> <span class="o">=</span> <span class="n">gps_data</span><span class="p">[</span><span class="n">futar</span><span class="p">.</span><span class="n">vehicleRouteType</span> <span class="o">==</span> <span class="sh">'</span><span class="s">FERRY</span><span class="sh">'</span><span class="p">]</span>
<span class="n">futar</span><span class="p">.</span><span class="n">vehicleRouteType</span><span class="p">.</span><span class="nf">value_counts</span><span class="p">()</span>
</code></pre></div></div> <div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>BUS           8468914
TRAM          1871667
TROLLEYBUS     698070
FERRY           16338
Name: vehicleRouteType, dtype: int64
</code></pre></div></div> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">p</span> <span class="o">=</span> <span class="n">bp</span><span class="p">.</span><span class="nf">figure</span><span class="p">(</span><span class="n">tools</span><span class="o">=</span><span class="sh">'</span><span class="s">pan,wheel_zoom,reset</span><span class="sh">'</span><span class="p">,</span>
              <span class="n">plot_width</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">plot_height</span><span class="o">=</span><span class="nf">int</span><span class="p">(</span><span class="mi">600</span><span class="p">),</span>
              <span class="n">x_range</span><span class="o">=</span><span class="p">(</span><span class="mf">2.101e6</span><span class="p">,</span> <span class="mf">2.155e6</span><span class="p">),</span>
              <span class="n">y_range</span><span class="o">=</span><span class="p">(</span><span class="mi">6012796</span><span class="p">,</span> <span class="mi">6038876</span><span class="p">))</span>
              
<span class="n">p</span><span class="p">.</span><span class="n">axis</span><span class="p">.</span><span class="n">visible</span> <span class="o">=</span> <span class="bp">False</span>
<span class="n">p</span><span class="p">.</span><span class="n">xgrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>
<span class="n">p</span><span class="p">.</span><span class="n">ygrid</span><span class="p">.</span><span class="n">grid_line_color</span> <span class="o">=</span> <span class="bp">None</span>

<span class="n">url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">https://cartodb-basemaps-b.global.ssl.fastly.net/dark_all/{z}/{x}/{y}.png</span><span class="sh">"</span>
<span class="n">tile_renderer</span> <span class="o">=</span> <span class="n">p</span><span class="p">.</span><span class="nf">add_tile</span><span class="p">(</span><span class="nc">WMTSTileSource</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">))</span>
<span class="n">tile_renderer</span><span class="p">.</span><span class="n">alpha</span> <span class="o">=</span> <span class="mi">1</span>

<span class="k">def</span> <span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">color_fn</span><span class="o">=</span><span class="n">tf</span><span class="p">.</span><span class="n">shade</span><span class="p">):</span>
    <span class="n">cvs</span> <span class="o">=</span> <span class="n">ds</span><span class="p">.</span><span class="nc">Canvas</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="n">w</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="n">h</span><span class="p">,</span> <span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">)</span>
    <span class="n">agg_bus</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">points</span><span class="p">(</span><span class="n">data_bus</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>
    <span class="n">agg_tram</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">points</span><span class="p">(</span><span class="n">data_tram</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>
    <span class="n">agg_trolleybus</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">points</span><span class="p">(</span><span class="n">data_trolleybus</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>
    <span class="n">agg_ferry</span> <span class="o">=</span> <span class="n">cvs</span><span class="p">.</span><span class="nf">points</span><span class="p">(</span><span class="n">data_ferry</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_x</span><span class="sh">'</span><span class="p">,</span> <span class="sh">'</span><span class="s">coord_y</span><span class="sh">'</span><span class="p">,</span> <span class="n">agg</span><span class="o">=</span><span class="n">ds</span><span class="p">.</span><span class="nf">count</span><span class="p">())</span>
    <span class="n">image_bus</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg_bus</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="p">[(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">71</span><span class="p">,</span> <span class="mi">111</span><span class="p">),</span> <span class="p">(</span><span class="mi">8</span><span class="p">,</span> <span class="mi">119</span><span class="p">,</span> <span class="mi">188</span><span class="p">)],</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">image_tram</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg_tram</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="p">[(</span><span class="mi">115</span><span class="p">,</span> <span class="mi">72</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span> <span class="p">(</span><span class="mi">248</span><span class="p">,</span> <span class="mi">155</span><span class="p">,</span> <span class="mi">0</span><span class="p">)],</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">image_trolleybus</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg_trolleybus</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="p">[(</span><span class="mi">136</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">6</span><span class="p">),</span> <span class="p">(</span><span class="mi">255</span><span class="p">,</span> <span class="mi">33</span><span class="p">,</span> <span class="mi">42</span><span class="p">)],</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">image_ferry</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">shade</span><span class="p">(</span><span class="n">agg_ferry</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="p">[(</span><span class="mi">112</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">67</span><span class="p">),</span> <span class="p">(</span><span class="mi">214</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">128</span><span class="p">)],</span> <span class="n">how</span><span class="o">=</span><span class="sh">'</span><span class="s">eq_hist</span><span class="sh">'</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tf</span><span class="p">.</span><span class="nf">stack</span><span class="p">(</span><span class="n">image_bus</span><span class="p">,</span> <span class="n">image_tram</span><span class="p">,</span> <span class="n">image_trolleybus</span><span class="p">,</span> <span class="n">image_ferry</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tf</span><span class="p">.</span><span class="nf">dynspread</span><span class="p">(</span><span class="n">image</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="n">max_px</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>

<span class="nf">export_image</span><span class="p">(</span><span class="nf">image_callback</span><span class="p">(</span><span class="n">x_range</span><span class="o">=</span><span class="n">x_range</span><span class="p">,</span> <span class="n">y_range</span><span class="o">=</span><span class="n">y_range</span><span class="p">,</span> <span class="n">w</span><span class="o">=</span><span class="mi">2000</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="mi">2000</span><span class="p">),</span>
             <span class="n">filename</span><span class="o">=</span><span class="sh">"</span><span class="s">BUD_gps_by_type</span><span class="sh">"</span><span class="p">,</span> <span class="n">background</span><span class="o">=</span><span class="sh">'</span><span class="s">black</span><span class="sh">'</span><span class="p">)</span>
<span class="nc">InteractiveImage</span><span class="p">(</span><span class="n">p</span><span class="p">,</span> <span class="n">image_callback</span><span class="p">)</span>
</code></pre></div></div> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/plot3_snip-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/plot3_snip-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/plot3_snip-1400.webp"></source> <img src="/assets/img/bkk/plot3_snip.png" width="600" height="auto" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> <p>Thatâ€™s it for this post. Hope it was useful and/or interesting for you. Finally, some high-res versions of the above pictures with no map in the background (right-click and open in new tab to get to full res version):</p> <div class="row mt-3"> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/BUD_schedule_fire-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/BUD_schedule_fire-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/BUD_schedule_fire-1400.webp"></source> <img src="/assets/img/bkk/BUD_schedule_fire.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/BUD_gps_fire-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/BUD_gps_fire-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/BUD_gps_fire-1400.webp"></source> <img src="/assets/img/bkk/BUD_gps_fire.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> <div class="col-sm mt-3 mt-md-0"> <figure> <picture> <source class="responsive-img-srcset" media="(max-width: 480px)" srcset="/assets/img/bkk/BUD_gps_by_type-480.webp"></source> <source class="responsive-img-srcset" media="(max-width: 800px)" srcset="/assets/img/bkk/BUD_gps_by_type-800.webp"></source> <source class="responsive-img-srcset" media="(max-width: 1400px)" srcset="/assets/img/bkk/BUD_gps_by_type-1400.webp"></source> <img src="/assets/img/bkk/BUD_gps_by_type.png" class="img-fluid rounded z-depth-1" width="auto" height="auto" data-zoomable="" onerror="this.onerror=null; $('.responsive-img-srcset').remove();"> </picture> </figure> </div> </div> <p>Happy plotting!</p> <h2 id="appendix-getting-real-time-gps-data">Appendix: getting real-time GPS data</h2> <p>BKK has a surprisingly good API to obtain real-time GPS data, accompanied by the also surprising lack of official documentation. Nevertheless, the following resources proved very useful (alas, they they are only available in hungarian):</p> <ul> <li><a href="http://docs.bkkfutar.apiary.io/#" target="_blank" rel="noopener noreferrer">An Apiary description</a></li> <li><a href="http://forum.index.hu/Article/showArticle?na_start=0&amp;na_step=30&amp;t=9211676&amp;na_order=" target="_blank" rel="noopener noreferrer">Index forum for BKK data users</a></li> <li><a href="https://balassygyorgy.wordpress.com/2016/02/02/bkk-futar-microsoft-bandre-2-bkk-futar-api/" target="_blank" rel="noopener noreferrer">The blog of GyÃ¶rgy BalÃ¡ssy</a></li> </ul> <p>The final code that was used to download the data is displayed below withous any further comments. Should be quite self-explanatory.</p> <div class="language-python highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kn">import</span> <span class="n">os</span>
<span class="kn">import</span> <span class="n">requests</span>
<span class="kn">import</span> <span class="n">time</span>
<span class="kn">import</span> <span class="n">datetime</span>
<span class="kn">import</span> <span class="n">pandas</span> <span class="k">as</span> <span class="n">pd</span>

<span class="k">def</span> <span class="nf">vehicles_for_location</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">lat_span</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">lon_span</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                          <span class="n">lat</span><span class="o">=</span><span class="mf">47.498412</span><span class="p">,</span>
                          <span class="n">lon</span><span class="o">=</span><span class="mf">19.04037</span><span class="p">,</span>
                          <span class="n">key</span><span class="o">=</span><span class="sh">'</span><span class="s">test</span><span class="sh">'</span><span class="p">,</span>
                          <span class="n">version</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
    
    <span class="k">if</span> <span class="n">lat_span</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">lon_span</span> <span class="ow">is</span> <span class="bp">None</span> <span class="ow">and</span> <span class="n">radius</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="nc">TypeError</span><span class="p">(</span><span class="sh">"</span><span class="s">Either radius or lon_span and lat_span must be supplied</span><span class="sh">"</span><span class="p">)</span>
    
    <span class="n">params</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">lat</span><span class="sh">'</span><span class="p">:</span> <span class="n">lat</span><span class="p">,</span>
              <span class="sh">'</span><span class="s">lon</span><span class="sh">'</span><span class="p">:</span> <span class="n">lon</span><span class="p">,</span>
              <span class="sh">'</span><span class="s">key</span><span class="sh">'</span><span class="p">:</span> <span class="n">key</span><span class="p">,</span>
              <span class="sh">'</span><span class="s">version</span><span class="sh">'</span><span class="p">:</span> <span class="n">version</span><span class="p">}</span>
    <span class="k">if</span> <span class="n">radius</span> <span class="ow">is</span> <span class="ow">not</span> <span class="bp">None</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="sh">'</span><span class="s">radius</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">radius</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">params</span><span class="p">[</span><span class="sh">'</span><span class="s">latSpan</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lat_span</span>
        <span class="n">params</span><span class="p">[</span><span class="sh">'</span><span class="s">lonSpan</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">lon_span</span>
    
    <span class="n">base_url</span> <span class="o">=</span> <span class="sh">"</span><span class="s">http://futar.bkk.hu/bkk-utvonaltervezo-api/ws/otp/api/where/vehicles-for-location.json</span><span class="sh">"</span>
    <span class="n">req</span> <span class="o">=</span> <span class="n">requests</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">params</span><span class="p">)</span>
    <span class="n">req</span><span class="p">.</span><span class="nf">raise_for_status</span><span class="p">()</span>
    
    <span class="k">if</span> <span class="n">req</span><span class="p">.</span><span class="n">ok</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="s">Successful request at {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">"</span><span class="p">)))</span>
    
    <span class="k">return</span> <span class="n">req</span><span class="p">.</span><span class="nf">json</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">store_vfl</span><span class="p">(</span><span class="n">vfl_req</span><span class="p">,</span> <span class="n">path</span><span class="p">):</span>
    
    <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="p">.</span><span class="nc">DataFrame</span><span class="p">(</span><span class="n">vfl_req</span><span class="p">[</span><span class="sh">'</span><span class="s">data</span><span class="sh">'</span><span class="p">][</span><span class="sh">'</span><span class="s">list</span><span class="sh">'</span><span class="p">])</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isfile</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">w</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
                <span class="n">df</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">with</span> <span class="nf">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="sh">'</span><span class="s">a</span><span class="sh">'</span><span class="p">)</span> <span class="k">as</span> <span class="nb">file</span><span class="p">:</span>
            <span class="n">df</span><span class="p">.</span><span class="nf">to_csv</span><span class="p">(</span><span class="nb">file</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">run_scraper</span><span class="p">(</span><span class="n">interval</span><span class="p">,</span>
                <span class="n">run_until</span><span class="p">,</span>
                <span class="n">path</span><span class="p">,</span>
                <span class="n">min_interval</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
                <span class="n">radius</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">lat_span</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span>
                <span class="n">lon_span</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>

    <span class="k">while</span> <span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span> <span class="o">&lt;</span> <span class="n">run_until</span><span class="p">:</span>
        <span class="n">t0</span> <span class="o">=</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">()</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">vfl</span> <span class="o">=</span> <span class="nf">vehicles_for_location</span><span class="p">(</span><span class="n">radius</span><span class="o">=</span><span class="n">radius</span><span class="p">,</span> <span class="n">lat_span</span><span class="o">=</span><span class="n">lat_span</span><span class="p">,</span> <span class="n">lon_span</span><span class="o">=</span><span class="n">lon_span</span><span class="p">)</span>
        <span class="nf">except </span><span class="p">(</span><span class="nb">KeyboardInterrupt</span><span class="p">,</span> <span class="nb">SystemExit</span><span class="p">):</span>
            <span class="k">raise</span>
        <span class="k">except</span> <span class="n">requests</span><span class="p">.</span><span class="n">exceptions</span><span class="p">.</span><span class="n">HTTPError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">Unuccessful request at {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">"</span><span class="p">)))</span>
        <span class="k">except</span> <span class="nb">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nf">print</span><span class="p">(</span><span class="sh">'</span><span class="se">\n</span><span class="s">Something went wrong at {}</span><span class="sh">'</span><span class="p">.</span><span class="nf">format</span><span class="p">(</span><span class="n">datetime</span><span class="p">.</span><span class="n">datetime</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">strftime</span><span class="p">(</span><span class="sh">"</span><span class="s">%Y-%m-%d %H:%M:%S</span><span class="sh">"</span><span class="p">)))</span>
        <span class="nf">store_vfl</span><span class="p">(</span><span class="n">vfl</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        
        <span class="n">sleep_time</span> <span class="o">=</span> <span class="nf">max</span><span class="p">(</span><span class="n">min_interval</span><span class="p">,</span> <span class="n">t0</span> <span class="o">+</span> <span class="n">interval</span> <span class="o">-</span> <span class="n">time</span><span class="p">.</span><span class="nf">time</span><span class="p">())</span>
        <span class="n">time</span><span class="p">.</span><span class="nf">sleep</span><span class="p">(</span><span class="n">sleep_time</span><span class="p">)</span>

<span class="c1"># if __name__ == "__main__":
</span>    <span class="c1"># run_until = datetime.datetime(2018, 10, 12, 22, 10, 00)
</span>    <span class="c1"># path = '/bkkdata/vfl_data.csv'
</span>    <span class="c1"># run_scraper(10, run_until, path, 100)
</span></code></pre></div></div> </article> </div> </div> <footer class="sticky-bottom mt-5"> <div class="container"> Â© Copyright 2025 Martin Stancsics. Powered by <a href="https://jekyllrb.com/" target="_blank" rel="noopener noreferrer">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" target="_blank" rel="noopener noreferrer">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="noopener noreferrer">GitHub Pages</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js" integrity="sha256-fgLAgv7fyCGopR/gBNq2iW3ZKIdqIcyshnUULC4vex8=" crossorigin="anonymous"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@4/imagesloaded.pkgd.min.js"></script> <script defer src="/assets/js/masonry.js" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js"></script> <script defer src="/assets/js/common.js"></script> <script type="text/javascript">window.MathJax={tex:{tags:"ams"}};</script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js"></script> <script defer src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> </body> </html>